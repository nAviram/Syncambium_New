//chatter Module

var all_sockets = null;

exports.set_sockets = function  (sockets) {
  all_sockets = sockets;
};

exports.connect_chatter = function  (config) {

  
  config.socket.on('entrance', function(){
  	config.socket.emit('entrance', {WelcomeMsg: 'Welcome to the chat room!'});
  	config.DBconnector.querySelectChat(config.socket);
  	all_sockets.emit('entrance', {WelcomeMsg: config.username + ' is online.'});
  });
  
  
  config.socket.on('disconnect', function  () {
    all_sockets.emit('exit', {message: config.username + ' has disconnected.'});
  });
  
  config.socket.on('chat', function  (data) {
  	var dataToClient = {username: config.username, message:data.message};
  	all_sockets.emit('chat', dataToClient);	
  	var dataToDB = {username:config.username, message:data.message};	
  	config.DBconnector.queryInsertChat(config.socket, dataToDB);	
  });
  
};

exports.failure = function  (socket) {
  socket.emit('error', {message: 'Please log in to the chatroom.'});
};

